(function(a){a.fn.flickrPolaroid=function(b){var c={tags:"lachlanhardy"};var b=a.extend(c,b);return this.each(function(){canvas=a(this);function d(h){var k=jQuery.makeArray(h);var p=Math.ceil(Math.random()*(h.items.length-1));var s=h.items[p];a("<a/>").attr("href",s.link).attr("id","polaroid").prependTo(canvas);var m=parseInt(s.description.match(/width="(\d*)/)[1],10);var n=parseInt(s.description.match(/height="(\d*)/)[1],10);var l=(m+40);var o=(n+60);var j=[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18];var q=Math.ceil(Math.random()*(j.length-1));var f=Raphael("polaroid",l+100,o+100);f.rect(55,63,l,o).attr({fill:"#000",opacity:0.15,stroke:"#000","stroke-width":4,"stroke-opacity":0.3}).rotate(j[q]-1);f.rect(50,55,l,o).attr({fill:"#fff",stroke:"#ddd","stroke-width":2,"stroke-opacity":0.3}).rotate(j[q]);canvas.css("margin","-1.5em 0 1em 0");f.image(s.media.m,70,75,m,n).rotate(j[q]);var g=s.author;g=g.match(/\(([a-zA-z0-9 *]*)\)/);f.text(l-85,o+40,"Taken by "+g[1]).attr({font:'700 10px "Zapfino", "Marker Felt", "Papyrus", "URW Chancery L"'}).rotate(j[q]-2);var i=a("<a/>").text("Try another image.").attr("id","refresh-link").attr("href","#refresh").click(function(r){canvas.css("margin","0 0 1em 0");a("p span",canvas).remove();i.remove();f.remove();d(h);r.preventDefault()});a("p",canvas).append(" <span>Not me?</span> ").append(i)}function e(){a.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?tags="+b.tags+" &format=json&jsoncallback=?",function(f){var g=a("p span",canvas);a("#polaroid").add(g).add("#refresh-link").remove();d(f)})}e();setInterval(e,36000000)})}})(jQuery);